{{- $dashboards := .Files.Glob "dashboards/*.json" }}
{{- range $dashboardPath, $binary := $dashboards }}
{{- $dashboardBase := base $dashboardPath }}
{{- $uid := $dashboards.Get $dashboardPath | regexFind "\"uid\":\\s*\"\\S*?\"" }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ trimSuffix ".json" $dashboardBase }}
  labels:
    app.kubernetes.io/name: {{ trimSuffix ".json" $dashboardBase }}
    app.kubernetes.io/part-of: {{ $.Release.Name }}
    grafana_dashboard: "1"
data:
  {{ $dashboardBase }}: >
{{- if eq $uid "" }}
{{ $dashboards.Get $dashboardPath | indent 4 }}
{{- else }}
{{ $dashboards.Get $dashboardPath | replace $uid "\"uid\": null" | indent 4 }}
{{- end}}
---
{{- end }}